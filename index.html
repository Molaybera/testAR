<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Marker Scanner</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #info-panel {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 9999;
            text-align: center;
            max-width: 85%;
            font-size: 12px;
        }

        #info-panel h2 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #4CAF50;
        }

        #info-panel p {
            margin: 3px 0;
            font-size: 11px;
        }

        #marker-link {
            color: #64B5F6;
            text-decoration: none;
            font-weight: bold;
        }

        .status {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            z-index: 9999;
            font-size: 12px;
            display: none;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.85);
            padding: 20px 30px;
            border-radius: 10px;
            text-align: center;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 8px;
            font-size: 11px;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .a-canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        #error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(244, 67, 54, 0.95);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 10000;
            display: none;
            text-align: center;
            max-width: 80%;
        }
    </style>
</head>
<body>
    <div id="info-panel">
        <h2>ðŸ“± AR Marker Scanner</h2>
        <p>Point camera at Hiro marker</p>
        <p style="font-size: 10px; margin-top: 5px;">
            <a id="marker-link" href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" target="_blank">
                Download Marker
            </a>
        </p>
        <button class="close-btn" onclick="document.getElementById('info-panel').style.display='none'">OK</button>
    </div>

    <div id="status" class="status">Marker detected! ðŸŽ¯</div>
    <div id="loading" class="loading">
        Starting camera...<br>
        <small>Please allow camera access</small>
    </div>
    <div id="error-message"></div>

    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; trackingMethod: best; sourceWidth: 1280; sourceHeight: 960; displayWidth: 1280; displayHeight: 960;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true;"
        device-orientation-permission-ui="enabled: false">
        
        <a-marker preset="hiro" id="marker" emitevents="true" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
            
            <!-- HUGE RED CUBE -->
            <a-box 
                position="0 1.5 0" 
                scale="3 3 3"
                rotation="0 45 45"
                color="#FF0000"
                animation="property: rotation; to: 360 405 405; loop: true; dur: 4000; easing: linear"
                material="opacity: 1; metalness: 0.5; roughness: 0.3">
            </a-box>

            <!-- GIANT YELLOW TEXT -->
            <a-text 
                value="AR WORKS!" 
                position="0 4 0" 
                align="center" 
                color="#FFFF00"
                width="10"
                scale="3 3 3">
            </a-text>

            <!-- BIG GREEN SPHERE -->
            <a-sphere 
                position="4 1.5 0" 
                radius="1" 
                color="#00FF00"
                material="metalness: 0.8">
            </a-sphere>

            <!-- BLUE PLATFORM -->
            <a-cylinder 
                position="0 0 0" 
                radius="2.5" 
                height="0.5" 
                color="#0000FF">
            </a-cylinder>

            <!-- MAGENTA RING -->
            <a-torus 
                position="0 1.5 0" 
                radius="3" 
                radius-tubular="0.2" 
                color="#FF00FF"
                rotation="90 0 0"
                animation="property: rotation; to: 90 360 0; loop: true; dur: 6000; easing: linear">
            </a-torus>

        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let cameraReady = false;
        const loading = document.getElementById('loading');
        const status = document.getElementById('status');
        const errorMsg = document.getElementById('error-message');

        // Better error handling
        window.addEventListener('error', function(e) {
            console.error('Error:', e.message);
            showError('Error: ' + e.message);
        });

        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.style.display = 'block';
            loading.style.display = 'none';
        }

        // Wait for AR.js to be ready
        window.addEventListener('load', function() {
            console.log('Page loaded, initializing AR...');
            
            const scene = document.querySelector('a-scene');
            
            // Check if scene loaded
            if (scene.hasLoaded) {
                onSceneLoaded();
            } else {
                scene.addEventListener('loaded', onSceneLoaded);
            }

            // Timeout check
            setTimeout(() => {
                if (!cameraReady) {
                    loading.innerHTML = 'Camera starting...<br><small style="font-size:10px;">This may take 10-20 seconds on some devices</small>';
                }
            }, 3000);

            setTimeout(() => {
                if (!cameraReady) {
                    loading.style.display = 'none';
                    showError('Camera failed to start. Please refresh and allow camera access.');
                }
            }, 15000);
        });

        function onSceneLoaded() {
            console.log('AR Scene loaded successfully');
            
            setTimeout(() => {
                loading.style.display = 'none';
                cameraReady = true;
            }, 2000);

            const marker = document.querySelector('#marker');
            
            if (marker) {
                marker.addEventListener('markerFound', function() {
                    console.log('Marker found!');
                    status.style.display = 'block';
                    status.textContent = 'Marker detected! ðŸŽ¯';
                    status.style.background = 'rgba(76, 175, 80, 0.9)';
                });

                marker.addEventListener('markerLost', function() {
                    console.log('Marker lost');
                    status.textContent = 'Marker lost... ðŸ”';
                    status.style.background = 'rgba(244, 67, 54, 0.9)';
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 2000);
                });
            }
        }

        console.log('AR Marker Scanner Initialized');
        console.log('Make sure to:');
        console.log('1. Allow camera permissions');
        console.log('2. Use HTTPS (GitHub Pages does this automatically)');
        console.log('3. Print the Hiro marker');
    </script>
</body>
</html>